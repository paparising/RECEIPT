apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "receipt-app.fullname" . }}-config
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "receipt-app.labels" . | nindent 4 }}
data:
  application-kubernetes.properties: |
    # Spring Boot Application Properties for Kubernetes
    spring.application.name={{ .Values.app.name }}
    server.port={{ .Values.app.port }}
    
    # Database Configuration
    spring.datasource.url=jdbc:mysql://{{ .Values.database.host }}:{{ .Values.database.port }}/{{ .Values.database.name }}?useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=UTC
    spring.datasource.username={{ .Values.database.username }}
    spring.datasource.hikari.maximum-pool-size={{ .Values.database.hikariMaximumPoolSize }}
    spring.jpa.hibernate.ddl-auto={{ .Values.database.hibernate.ddlAuto }}
    spring.jpa.hibernate.dialect={{ .Values.database.hibernate.dialect }}
    spring.jpa.show-sql=false
    spring.jpa.properties.hibernate.format_sql=true
    
    # RabbitMQ Configuration
    spring.rabbitmq.host={{ .Values.rabbitmq.host }}
    spring.rabbitmq.port={{ .Values.rabbitmq.port }}
    spring.rabbitmq.username={{ .Values.rabbitmq.username }}
    spring.rabbitmq.virtual-host={{ .Values.rabbitmq.virtualHost }}
    spring.rabbitmq.connection-timeout={{ .Values.rabbitmq.connectionTimeout }}
    
    # Logging Configuration
    logging.level.root={{ .Values.logging.level.root }}
    logging.level.com.example.receipt={{ .Values.logging.level.com.example.receipt }}
    logging.pattern.console={{ .Values.logging.pattern }}
    
    # Management Endpoints
    management.endpoints.web.exposure.include=health,info,metrics,prometheus
    management.endpoint.health.show-details=when-authorized
    management.metrics.enabled=true
    management.prometheus.metrics.export.enabled=true
    
    # App Messaging Configuration
    app.messaging.max-retries=3
    app.messaging.retry-delay-ms=5000
